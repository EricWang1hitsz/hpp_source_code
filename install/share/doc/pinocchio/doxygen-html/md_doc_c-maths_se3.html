<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>pinocchio: CheatSheet: SE(3) operations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="pinocchio.ico" rel="icon" type="image/x-icon">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pinocchio.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">pinocchio
   &#160;<span id="projectnumber">2.1.3</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_doc_c-maths_se3.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">CheatSheet: SE(3) operations </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="center"></div><div class="center"> \( \newcommand{\BIN}{\begin{bmatrix}} \newcommand{\BOUT}{\end{bmatrix}} \newcommand{\calR}{\mathcal{R}} \newcommand{\calE}{\mathcal{E}} \newcommand{\repr}{\cong} \newcommand{\dpartial}[2]{\frac{\partial{#1}}{\partial{#2}}} \newcommand{\ddpartial}[2]{\frac{\partial^2{#1}}{\partial{#2}^2}} \newcommand{\aRb}{\ {}^{A}R_B} \newcommand{\aMb}{\ {}^{A}M_B} \newcommand{\amb}{\ {}^{A}m_B} \newcommand{\apb}{{\ {}^{A}{AB}{}}} \newcommand{\aXb}{\ {}^{A}X_B} \newcommand{\bRa}{\ {}^{B}R_A} \newcommand{\bMa}{\ {}^{B}M_A} \newcommand{\bma}{\ {}^{B}m_A} \newcommand{\bpa}{\ {}^{B}{BA}{}} \newcommand{\bXa}{\ {}^{B}X_A} \newcommand{\ap}{\ {}^{A}p} \newcommand{\bp}{\ {}^{B}p} \newcommand{\afs}{\ {}^{A}\phi} \newcommand{\bfs}{\ {}^{B}\phi} \newcommand{\af}{\ {}^{A}f} \renewcommand{\bf}{\ {}^{B}f} \newcommand{\an}{\ {}^{A}\tau} \newcommand{\bn}{\ {}^{B}\tau} \newcommand{\avs}{\ {}^{A}\nu} \newcommand{\bvs}{\ {}^{B}\nu} \newcommand{\w}{\omega} \newcommand{\av}{\ {}^{A}v} \newcommand{\bv}{\ {}^{B}v} \newcommand{\aw}{\ {}^{A}\w} \newcommand{\bw}{\ {}^{B}\w} \newcommand{\aI}{\ {}^{A}I} \newcommand{\bI}{\ {}^{B}I} \newcommand{\cI}{\ {}^{C}I} \newcommand{\aY}{\ {}^{A}Y} \newcommand{\bY}{\ {}^{B}Y} \newcommand{\cY}{\ {}^{c}Y} \newcommand{\aXc}{\ {}^{A}X_C} \newcommand{\aMc}{\ {}^{A}M_C} \newcommand{\aRc}{\ {}^{A}R_C} \newcommand{\apc}{\ {}^{A}{AC}{}} \newcommand{\bXc}{\ {}^{B}X_C} \newcommand{\bRc}{\ {}^{B}R_C} \newcommand{\bMc}{\ {}^{B}M_C} \newcommand{\bpc}{\ {}^{B}{BC}{}} \)</div><div class="center"><h2>Rigid transformation</h2>
</div><div class="center"></div><div class="center"> \(m : p \in \calE(3) \rightarrow m(p) \in E(3)\)</div><div class="center">Transformation from B to A:</div><div class="center"> \(\amb : \bp \in \calR^3 \repr \calE(3) \ \rightarrow\ \ap = \amb(\bp) = \aMb\ \bp\)</div><div class="center"> \( \ap = \aRb \bp + \apb\)</div><div class="center"> \(\aMb = \BIN \aRb &amp; \apb \\ 0 &amp; 1 \BOUT \)</div><div class="center">Transformation from A to B:</div><div class="center"> \(\bp = \aRb^T \ap + \bpa, \quad\textrm{with }\bpa = - \aRb^T \apb\)</div><div class="center"> \(\bMa = \BIN \aRb^T &amp; - \aRb^T \apb \\ 0 &amp; 1 \BOUT \)</div><div class="center">For Featherstone, \(E = \bRa =\aRb^T\) and \(r = \apb\). Then:</div><div class="center"> \(\bMa = \BIN \bRa &amp; -\bRa \apb \\ 0 &amp; 1 \BOUT = \BIN E &amp; -E r \\ 0 &amp; 1 \BOUT \)</div><div class="center"> \(\aMb = \BIN \bRa^T &amp; \apb \\ 0 &amp; 1 \BOUT = \BIN E^T &amp; r \\ 0 &amp; 1 \BOUT \)</div><div class="center"><h2>Composition</h2>
</div><div class="center"></div><div class="center"> \( \aMb \bMc = \BIN \aRb \bRc &amp; \apb + \aRb \bpc \\ 0 &amp; 1 \BOUT \)</div><div class="center"> \( \aMb^{-1} \aMc = \BIN \aRb^T \aRc &amp; \aRb^T (\apc - \apb) \\ 0 &amp; 1 \BOUT \)</div><div class="center"><h2>Motion Application</h2>
</div><div class="center"></div><div class="center"> \(\avs = \BIN \av \\ \aw \BOUT\)</div><div class="center"> \(\bvs = \bXa\avs\)</div><div class="center"> \( \aXb = \BIN \aRb &amp; \apb_\times \aRb \\ 0 &amp; \aRb \BOUT \)</div><div class="center"> \( \aXb^{-1} = \bXa = \BIN \aRb^T &amp; -\aRb^T \apb_\times \\ 0 &amp; \aRb^T \BOUT \)</div><div class="center">For Featherstone, \(E = \bRa =\aRb^T\) and \(r = \apb\). Then:</div><div class="center"> \( \bXa = \BIN \bRa &amp; - \bRa \apb_\times \\ 0 &amp; \bRa \BOUT = \BIN E &amp; -E r_\times \\ 0 &amp; E \BOUT\)</div><div class="center"> \( \aXb = \BIN \bRa^T &amp; \apb_\times \bRa^T \\ 0 &amp; \bRa^T \BOUT = \BIN E^T &amp; r_\times E^T \\ 0 &amp; E^T \BOUT\)</div><div class="center"><h2>Force Application</h2>
</div><div class="center"></div><div class="center"> \(\afs = \BIN \af \\ \an \BOUT\)</div><div class="center"> \(\bfs = \bXa^* \afs\)</div><div class="center">For any \(\phi,\nu\), \(\phi\dot\nu = \afs^T \avs = \bfs^T \bvs\) and then:</div><div class="center"> \(\aXb^* = \aXb^{-T} = \BIN \aRb &amp; 0 \\ \apb_\times \aRb &amp; \aRb \BOUT\)</div><div class="center">(because \(\apb_\times^T = - \apb_\times\)).</div><div class="center"> \(\aXb^{-*} = \bXa^* = \BIN \aRb^T &amp; 0 \\ -\aRb^T \apb_\times &amp; \aRb^T \BOUT\)</div><div class="center">For Featherstone, \(E = \bRa =\aRb^T\) and \(r = \apb\). Then:</div><div class="center"> \(\bXa^* = \BIN \bRa &amp; 0 \\ -\bRa \apb_\times &amp; \bRa \BOUT = \BIN E &amp; 0 \\ - E r_\times &amp; E \BOUT \)</div><div class="center"> \(\aXb^* = \BIN \bRa^T &amp; 0 \\ \apb_\times \bRa^T &amp; \bRa^T \BOUT = \BIN E^T &amp; 0 \\ r_\times E^T &amp; E^T \BOUT \)</div><div class="center"><h2>Inertia</h2>
</div><div class="center"> <h3>Inertia application</h3>
</div><div class="center"></div><div class="center"> \(\aY: \avs \rightarrow \afs = \aY \avs\)</div><div class="center">Coordinate transform:</div><div class="center"> \(\bY = \bXa^{*} \aY \bXa^{-1}\)</div><div class="center">since:</div><div class="center"> \(\bfs = \bXa^* \bfs = \bXa^* \aI \aXb \bvs\)</div><div class="center">Cannonical form. The inertia about the center of mass \(c\) is:</div><div class="center"> \(\cY = \BIN m &amp; 0 \\ 0 &amp; \cI \BOUT\)</div><div class="center">Expressed in any non-centered coordinate system \(A\): \(\aY = \aXc^* \cI \aXc^{-1} = \BIN m &amp; m\ ^AAC_\times^T \\ m\ ^AAC_\times &amp; \aI + m \apc_\times \apc\times^T \BOUT \)</div><div class="center">Changing the coordinates system from \(B\) to \(A\):</div><div class="center"> \(\aY = \aXb^* \bXc^* \cI \bXc^{-1} \aXb^{-1} \) \( = \BIN m &amp; m [\apb + \aRb \bpc]_\times^T \\ m [\apb + \aRb \bpc]_\times &amp; \aRb \bI \aRb^T - m [\apb + \aRb \bpc]_\times^2 \BOUT\)</div><div class="center">Representing the spatial inertia in \(B\) by the triplet \((m,\bpc,\bI)\), the expression in \(A\) is:</div><div class="center"> \( \amb: \bY = (m,\bpc,\bI) \rightarrow \aY = (m,\apb+\aRb \bpc,\aRb \bI \aRb^T)\)</div><div class="center">Similarly, the inverse action is:</div><div class="center"> \( \amb^{-1}: \aY \rightarrow \bY = (m,\aRb^T(^AAC-\apb),\aRb^T\aI \aRb) \)</div><div class="center">Motion-to-force map:</div><div class="center"> \( Y \nu = \BIN m &amp; mc_\times^T \\ mc_\times &amp; I+mc_\times c_\times^T \BOUT \BIN v \\ \omega \BOUT = \BIN m v - mc \times \omega \\ mc \times v + I \omega - mc \times ( c\times \omega) \BOUT\)</div><div class="center">Nota: the square of the cross product is: \(\BIN x\\y\\z\BOUT_ \times^2 = \BIN 0&amp;-z&amp;y \\ z&amp;0&amp;-x \\ -y&amp;x&amp;0 \BOUT^2 = \BIN -y^2-z^2&amp;xy&amp;xz \\ xy&amp;-x^2-z^2&amp;yz \\ xz&amp;yz&amp;-x^2-y^2 \BOUT\) There is no computational interest in using it.</div><div class="center"><h3>Inertia addition</h3>
</div><div class="center"></div><div class="center"> \( Y_p = \BIN m_p &amp; m_p p_\times^T \\ m_p p_\times &amp; I_p + m_p p_\times p_\times^T \BOUT\)</div><div class="center"> \( Y_q = \BIN m_q &amp; m_q q_\times^T \\ m_q q_\times &amp; I_q + m_q q_\times q_\times^T \BOUT\)</div><div class="center"><h2>Cross products</h2>
</div><div class="center"></div><div class="center">Motion-motion product:</div><div class="center"> \(\nu_1 \times \nu_2 = \BIN v_1\\\omega_1\BOUT \times \BIN v_2\\\omega_2\BOUT = \BIN v_1 \times \omega_2 + \omega_1 \times v_2 \\ \omega_1 \times \omega_2 \BOUT \)</div><div class="center">Motion-force product:</div><div class="center"> \(\nu \times \phi = \BIN v\\\omega\BOUT \times \BIN f\\ \tau \BOUT = \BIN \omega \times f \\ \omega \times \tau + v \times f \BOUT \)</div><div class="center">A special form of the motion-force product is often used:</div><div class="center"> \(\begin{align*}\nu \times (Y \nu) &amp;= \nu \times \BIN mv - mc\times \omega \\ mc\times v + I \omega - mc\times(c\times \omega) \BOUT \\&amp;= \BIN m \omega\times v - \omega\times(mc\times \omega) \\ \omega \times ( mc \times v) + \omega \times (I\omega) -\omega \times(c \times( mc\times \omega)) -v\times(mc \times \omega)\BOUT\end{align*}\)</div><div class="center">Setting \(\beta=mc \times \omega\), this product can be written:</div><div class="center"> \(\nu \times (Y \nu) = \BIN \omega \times (m v - \beta) \\ \omega \times( c \times (mv-\beta)+I\omega) - v \times \beta \BOUT\)</div><div class="center">This last form cost five \(\times\), four \(+\) and one \(3\times3\) matrix-vector multiplication.</div><div class="center"><h2>Joint</h2>
</div><div class="center"></div><div class="center">We denote by \(1\) the coordinate system attached to the parent (predecessor) body at the joint input, ad by \(2\) the coordinate system attached to the (child) successor body at the joint output. We neglect the possible time variation of the joint model (ie the bias velocity \(\sigma = \nu(q,0)\) is null).</div><div class="center">The joint geometry is expressed by the rigid transformation from the input to the ouput, parametrized by the joint coordinate system \(q \in \mathcal{Q}\):</div><div class="center"> \( ^2m_1 \repr \ ^2M_1(q)\)</div><div class="center">The joint velocity (i.e. the velocity of the child wrt. the parent in the child coordinate system) is:</div><div class="center"> \(^2\nu_{12} = \nu_J(q,v_q) = \ ^2S(q) v_q \)</div><div class="center">where \(^2S\) is the joint Jacobian (or constraint matrix) that define the motion subspace allowed by the joint, and \(v_q\) is the joint coordinate velocity (i.e. an element of the Lie algebra associated with the joint coordinate manifold), which would be \(v_q=\dot q\) when \(\dot q\) exists.</div><div class="center">The joint acceleration is:</div><div class="center"> \(^2\alpha_{12} = S \dot v_q + c_J + \ ^2\nu_{1} \times \ ^2\nu_{12}\)</div><div class="center">where \(c_J = \sum_{i=1}^{n_q} \dpartial{S}{q_i} \dot q_i\) (null in the usual cases) and \(^2\nu_{1}\) is the velocity of the parent body with respect to an absolute (Galilean) coordinate system</div><div class="center">NB: The abosulte velocity \(\nu_{1}\) is also the relative velocity wrt. the Galilean coordinate system \(\Omega\). The exhaustive notation should be \(\nu_{\Omega1}\) but \(\nu_1\) is prefered for simplicity.</div><div class="center">The joint calculations take as input the joint position \(q\) and velocity \(v_q\) and should output \(^2M_1\), \(^2\nu_{12}\) and \(^2c\) (this last vector being often a trivial \(0_6\) vector). In addition, the joint model should store the position of the joint input in the central coordinate system of the previous joint \(^0m_1\) which is a constant value.</div><div class="center">The joint integrator computes the exponential map associated with the joint manifold. The function inputs are the initial position \(q_0\), the velocity \(v_q\) and the length of the integration interval \(t\). It computes \(q_t\) as:</div><div class="center"> \( q_t = q_0 + \int_0^t v_q dt\)</div><div class="center">For the simple vectorial case where \(v_q=\dot q\), we have \(q_t=q_0 + t v_q\). Written in the more general case of a Lie groupe, we have \(q_t = q_0 exp(t v_q)\) where \(exp\) denotes the exponential map (i.e. integration of a constant vector field from the Lie algebra into the Lie group). This integration only consider first order explicit Euler. More general integrators (e.g. Runge-Kutta in Lie groupes) remains to be written. Adequate references are welcome.</div><div class="center"><h2>RNEA</h2>
</div><div class="center"></div><div class="center"><h3>Initialization</h3>
</div><div class="center"> \(^0\nu_0 = 0 ; \ ^0\alpha_0 = -g\)</div><div class="center">In the following, the coordinate system \(i\) is attached to the output of the joint (child body), while \(lambda(i)\) is the central coordinate system attached to the parent joint. The coordinated system associated with the joint input is denoted by \(i_0\). The constant rigid transformation from \(\lambda(i)\) to the joint input is then \(^{\lambda(i)}M_{i_0}\).</div><div class="center"><h3>Forward loop</h3>
</div><div class="center"> For each joint \(i\), update the joint calculation \(\mathbf j_i\).calc( \(q,v_q\)). This compute \(\mathbf{j}.M = \ ^{\lambda(i)}M_{i_0}(q)\), \(\mathbf{j}.\nu = \ ^i\nu_{{\lambda(i)}i}(q,v_q)\), \(\mathbf{j}.S = \ ^iS(q)\) and \(\mathbf{j}.c = \sum_{k=1}^{n_q} \dpartial{^iS}{q_k} \dot q_k\). Attached to the joint is also its placement in body \(\lambda(i)\) denoted by \(\mathbf{j}.M_0 =\ ^{\lambda(i)}M_{i_0}\). Then:</div><div class="center"> \(^{\lambda(i)}M_i = \mathbf{j}.M_0 \ \mathbf{j}.M \)</div><div class="center"> \(^0M_i = \ ^0M_{\lambda(i)} \ ^{\lambda(i)}M_i\)</div><div class="center"> \(^i\nu_{i}= \ ^{\lambda(i)}X_i^{-1} \ ^{\lambda(i)}\nu_{{\lambda(i)}} + \mathbf{j}.\nu\)</div><div class="center"> \(^i\alpha_{i}= \ ^{\lambda(i)}X_i^{-1} \ ^{\lambda(i)}\alpha_{{\lambda(i)}} + \mathbf{j}.S \dot v_q + \mathbf{j}.c + \ ^i\nu_{i} \times \mathbf{j}.\nu\)</div><div class="center"> \(^i\phi_i= \ ^iY_i \ ^i\alpha_i + \ ^i\nu_i \times \ ^iY_i \ ^i\nu_i - \ ^0X_i^{-*}\ ^0\phi_i^{ext}\)</div><div class="center"><h3>Backward loop</h3>
</div><div class="center"> For each joint \(i\) from leaf to root, do:</div><div class="center"> \(\tau_i = \mathbf{j}.S^T \ ^i\phi_i\)</div><div class="center"> \(^{\lambda(i)}\phi_{\lambda(i)} \ +\!\!= \ ^{\lambda(i)}X_i^{*} \ ^i\phi_i\)</div><div class="center"><h3>Nota</h3>
</div><div class="center"> It is more efficient to apply \(X^{-1}\) than \(X\). Similarly, it is more efficient to apply \(X^{-*}\) than \(X^*\). Therefore, it is better to store the transformations \(^{\lambda(i)}m_i\) and \(^0m_i\) than \(^im_{\lambda(i)}\) and \(^im_0\).</div><div class="center"></div> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Aug 20 2019 11:12:35 for pinocchio by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
