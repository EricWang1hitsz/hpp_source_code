<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>pinocchio: Inverse kinematics (clik)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="pinocchio.ico" rel="icon" type="image/x-icon">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="pinocchio.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">pinocchio
   &#160;<span id="projectnumber">2.1.3</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_doc_b-examples_i-inverse-kinematics.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Inverse kinematics (clik) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example shows how to position the end effector of a manipulator robot to a given position. The example employs a simple Jacobian-based iterative algorithm, which is called closed-loop inverse kinematics (CLIK).</p>
<h2>Python</h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">import</span> pinocchio</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;model = pinocchio.buildSampleModelManipulator()</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;data  = model.createData()</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;JOINT_ID = 6</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;xdes     = np.matrix([ 0.5,-0.5,0.5]).T</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;q        = <a class="code" href="namespacepinocchio.html#aaecd045e49ac75aeffcf7df22b156274">pinocchio.neutral</a>(model)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;eps      = 1e-4</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;IT_MAX   = 1000</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;DT       = 1e-1</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;i=0</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keywordflow">while</span> <span class="keyword">True</span>:</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <a class="code" href="namespacepinocchio.html#a601f17282020e4bb7d3e6f72b934fbe4">pinocchio.forwardKinematics</a>(model,data,q)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    x   = data.oMi[JOINT_ID].translation</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    R   = data.oMi[JOINT_ID].rotation</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    err = R.T*(x-xdes)</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">if</span> np.linalg.norm(err) &lt; eps:</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        print(<span class="stringliteral">&quot;Convergence achieved!&quot;</span>)</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <span class="keywordflow">break</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordflow">if</span> i &gt;= IT_MAX:</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        print(<span class="stringliteral">&quot;\nWarning: the iterative algorithm has not reached convergence to the desired precision&quot;</span>)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <span class="keywordflow">break</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    J   = <a class="code" href="namespacepinocchio.html#a663e44bbdbc0c2c3aec1524cb4f162de">pinocchio.jointJacobian</a>(model,data,q,JOINT_ID)[:3,:]</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    v   = - np.linalg.pinv(J)*err</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    q   = <a class="code" href="namespacepinocchio.html#a287574ae016b5828cd9ce36d3824770e">pinocchio.integrate</a>(model,q,v*DT)</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> i % 10:        print(<span class="stringliteral">&#39;error = %s&#39;</span> % err.T)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    i += 1</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;print(<span class="stringliteral">&#39;\nresult: %s&#39;</span> % q.flatten().tolist())</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;print(<span class="stringliteral">&#39;\nfinal error: %s&#39;</span> % err.T)</div><div class="ttc" id="namespacepinocchio_html_aaecd045e49ac75aeffcf7df22b156274"><div class="ttname"><a href="namespacepinocchio.html#aaecd045e49ac75aeffcf7df22b156274">pinocchio::neutral</a></div><div class="ttdeci">Eigen::Matrix&lt; typename LieGroupCollection::Scalar, Eigen::Dynamic, 1, LieGroupCollection::Options &gt; neutral(const LieGroupGenericTpl&lt; LieGroupCollection &gt; &amp;lg)</div><div class="ttdoc">Visit a LieGroupVariant to get the neutral element of it. </div></div>
<div class="ttc" id="namespacepinocchio_html_a287574ae016b5828cd9ce36d3824770e"><div class="ttname"><a href="namespacepinocchio.html#a287574ae016b5828cd9ce36d3824770e">pinocchio::integrate</a></div><div class="ttdeci">void integrate(const LieGroupGenericTpl&lt; LieGroupCollection &gt; &amp;lg, const Eigen::MatrixBase&lt; ConfigIn_t &gt; &amp;q, const Eigen::MatrixBase&lt; Tangent_t &gt; &amp;v, const Eigen::MatrixBase&lt; ConfigOut_t &gt; &amp;qout)</div><div class="ttdoc">Visit a LieGroupVariant to call its integrate method. </div></div>
<div class="ttc" id="namespacepinocchio_html_a663e44bbdbc0c2c3aec1524cb4f162de"><div class="ttname"><a href="namespacepinocchio.html#a663e44bbdbc0c2c3aec1524cb4f162de">pinocchio::jointJacobian</a></div><div class="ttdeci">PINOCCHIO_DEPRECATED const Data::Matrix6x &amp; jointJacobian(const Model &amp;model, Data &amp;data, const Eigen::VectorXd &amp;q, const Model::JointIndex jointId)</div><div class="ttdoc">Computes the Jacobian of a specific joint frame expressed in the local frame of the joint...</div><div class="ttdef"><b>Definition:</b> <a href="jacobian_8hpp_source.html#l00220">jacobian.hpp:220</a></div></div>
<div class="ttc" id="namespacepinocchio_html_a601f17282020e4bb7d3e6f72b934fbe4"><div class="ttname"><a href="namespacepinocchio.html#a601f17282020e4bb7d3e6f72b934fbe4">pinocchio::forwardKinematics</a></div><div class="ttdeci">void forwardKinematics(const ModelTpl&lt; Scalar, Options, JointCollectionTpl &gt; &amp;model, DataTpl&lt; Scalar, Options, JointCollectionTpl &gt; &amp;data, const Eigen::MatrixBase&lt; ConfigVectorType &gt; &amp;q, const Eigen::MatrixBase&lt; TangentVectorType1 &gt; &amp;v, const Eigen::MatrixBase&lt; TangentVectorType2 &gt; &amp;a)</div><div class="ttdoc">Update the joint placements, spatial velocities and spatial accelerations according to the current jo...</div></div>
</div><!-- fragment --><h3>Explanation of the code</h3>
<p>First of all, we import the necessary libraries and we create the <code>Model</code> and <code>Data</code> objects: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;from __future__ import print_function</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;import numpy as np</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;import pinocchio</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;model = pinocchio.buildSampleModelManipulator()</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;data  = model.createData()</div></div><!-- fragment --></p>
<p>The end effector corresponds to the 6th joint <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;JOINT_ID = 6</div></div><!-- fragment --></p>
<p>and its desired position is given as <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;xdes     = np.matrix([ 0.5,-0.5,0.5]).T</div></div><!-- fragment --></p>
<p>Next, we define an initial configuration <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;q        = pinocchio.neutral(model)</div></div><!-- fragment --></p>
<p>This is the starting point of the algorithm. <em>A priori</em>, any valid configuration would work. We decided to use the robot's neutral configuration, returned by algorithm <code>neutral</code>. For a simple manipulator such as the one in this case, it simply corresponds to an all-zero vector, but using this method generalizes well to more complex kinds of robots, ensuring validity.</p>
<p>Next, we set some computation-related values <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;eps      = 1e-4</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;IT_MAX   = 1000</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;DT       = 1e-1</div></div><!-- fragment --> corresponding to the desired position precision (a tenth of a millimeter will do), a maximum number of iterations (to avoid infinite looping in case the position is not reachable) and a positive "time step" defining the convergence rate.</p>
<p>Then, we begin the iterative process. At each iteration, we begin by computing the end-effector pose for the current configuration value: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    pinocchio.forwardKinematics(model,data,q)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;    x   = data.oMi[JOINT_ID].translation</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    R   = data.oMi[JOINT_ID].rotation</div></div><!-- fragment --></p>
<p>Next, we compute the error between the desired position and the current one. Notice we chose to express it in the local joint frame: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    err = R.T*(x-xdes)</div></div><!-- fragment --></p>
<p>If the error norm is below the previously-defined threshold, we have found the solution and we break out of the loop <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    if np.linalg.norm(err) &lt; eps:</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;        print(&quot;Convergence achieved!&quot;)</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        break</div></div><!-- fragment --></p>
<p>If we have reached the maximum number of iterations, it means a solution has not been found. We print an error message and we also break <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    if i &gt;= IT_MAX:</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;        print(&quot;\nWarning: the iterative algorithm has not reached convergence to the desired precision&quot;)</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;        break</div></div><!-- fragment --></p>
<p>Otherwise, we search for another configuration trying to reduce the error.</p>
<p>We start by computing the Jacobian, also in the local joint frame. Since we are only interested in the position, and not in the orientation, we select the first three lines, corresponding to the translation part <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    J   = pinocchio.jointJacobian(model,data,q,JOINT_ID)[:3,:]</div></div><!-- fragment --></p>
<p>Next, we can compute the evolution of the configuration by taking the pseudo-inverse of the Jacobian: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    v   = - np.linalg.pinv(J)*err</div></div><!-- fragment --></p>
<p>Finally, we can add the obtained tangent vector to the current configuration <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    q   = pinocchio.integrate(model,q,v*DT)</div></div><!-- fragment --></p>
<p>where <code>integrate</code> in our case amounts to a simple sum. The resulting error will be verified in the next iteration.</p>
<p>At the end of the loop, we display the result: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;print(&#39;\nresult: %s&#39; % q.flatten().tolist())</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;print(&#39;\nfinal error: %s&#39; % err.T)</div></div><!-- fragment --></p>
<h2>C++</h2>
<p>The equivalent C++ implemetation is given below</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;pinocchio/parsers/sample-models.hpp&quot;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &quot;pinocchio/algorithm/kinematics.hpp&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;pinocchio/algorithm/jacobian.hpp&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;pinocchio/algorithm/joint-configuration.hpp&quot;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> <span class="comment">/* argc */</span>, <span class="keywordtype">char</span> ** <span class="comment">/* argv */</span>)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <a class="code" href="structpinocchio_1_1ModelTpl.html">pinocchio::Model</a> model;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  <a class="code" href="namespacepinocchio_1_1buildModels.html#accd83f24a102dbe4845cedc1c9a52f4b">pinocchio::buildModels::manipulator</a>(model);</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <a class="code" href="structpinocchio_1_1DataTpl.html">pinocchio::Data</a> data(model);</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span>    JOINT_ID = 6;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  Eigen::Vector3d xdes;        xdes &lt;&lt; 0.5, -0.5, 0.5;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  Eigen::VectorXd q     = <a class="code" href="namespacepinocchio.html#ac1ea82f003a9814a0b1e127d42d32d73">pinocchio::neutral</a>(model);</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> eps      = 1e-4;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> IT_MAX      = 1000;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> DT       = 1e-1;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <a class="code" href="structpinocchio_1_1DataTpl.html#a417ed37ac15812b72b387b569a16b8d9">pinocchio::Data::Matrix6x</a> J(6,model.<a class="code" href="structpinocchio_1_1ModelTpl.html#aab6822646f9a53265acb577886434744">nv</a>); J.setZero();</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> svdOptions = Eigen::ComputeThinU | Eigen::ComputeThinV;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  Eigen::BDCSVD&lt;pinocchio::Data::Matrix3x&gt; svd(3,model.<a class="code" href="structpinocchio_1_1ModelTpl.html#aab6822646f9a53265acb577886434744">nv</a>,svdOptions);</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  Eigen::Vector3d err;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;;i++)</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  {</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <a class="code" href="namespacepinocchio.html#a97be7e9cd332a591b1431e30bab2c51e">pinocchio::forwardKinematics</a>(model,data,q);</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keyword">const</span> Eigen::Vector3d &amp; x   = data.oMi[JOINT_ID].translation();</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">const</span> Eigen::Matrix3d &amp; R   = data.oMi[JOINT_ID].rotation();</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    err = R.transpose()*(x-xdes);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">if</span>(err.norm() &lt; eps)</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    {</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;Convergence achieved!&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    }</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span> (i &gt;= IT_MAX)</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    {</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;\nWarning: the iterative algorithm has not reached convergence to the desired precision&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="namespacepinocchio.html#ad90c83a5f87f766625218793316cbe40">pinocchio::jointJacobian</a>(model,data,q,JOINT_ID,J);</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keyword">const</span> Eigen::VectorXd v     = - svd.compute(J.topRows&lt;3&gt;()).solve(err);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    q = <a class="code" href="namespacepinocchio.html#ac6d83ab51df727a51d3f6caeaa0ff5d9">pinocchio::integrate</a>(model,q,v*DT);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">if</span>(!(i%10)) std::cout &lt;&lt; <span class="stringliteral">&quot;error = &quot;</span> &lt;&lt; err.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  }</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;\nresult: &quot;</span> &lt;&lt; q.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;\nfinal error: &quot;</span> &lt;&lt; err.transpose() &lt;&lt; std::endl;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div><div class="ttc" id="namespacepinocchio_html_ac6d83ab51df727a51d3f6caeaa0ff5d9"><div class="ttname"><a href="namespacepinocchio.html#ac6d83ab51df727a51d3f6caeaa0ff5d9">pinocchio::integrate</a></div><div class="ttdeci">void integrate(const ModelTpl&lt; Scalar, Options, JointCollectionTpl &gt; &amp;model, const Eigen::MatrixBase&lt; ConfigVectorType &gt; &amp;q, const Eigen::MatrixBase&lt; TangentVectorType &gt; &amp;v, const Eigen::MatrixBase&lt; ReturnType &gt; &amp;qout)</div><div class="ttdoc">Integrate a configuration vector for the specified model for a tangent vector during one unit time...</div><div class="ttdef"><b>Definition:</b> <a href="joint-configuration_8hpp_source.html#l00048">joint-configuration.hpp:48</a></div></div>
<div class="ttc" id="structpinocchio_1_1DataTpl_html"><div class="ttname"><a href="structpinocchio_1_1DataTpl.html">pinocchio::DataTpl</a></div><div class="ttdef"><b>Definition:</b> <a href="data_8hpp_source.html#l00025">data.hpp:25</a></div></div>
<div class="ttc" id="namespacepinocchio_html_ad90c83a5f87f766625218793316cbe40"><div class="ttname"><a href="namespacepinocchio.html#ad90c83a5f87f766625218793316cbe40">pinocchio::jointJacobian</a></div><div class="ttdeci">void jointJacobian(const ModelTpl&lt; Scalar, Options, JointCollectionTpl &gt; &amp;model, DataTpl&lt; Scalar, Options, JointCollectionTpl &gt; &amp;data, const Eigen::MatrixBase&lt; ConfigVectorType &gt; &amp;q, const JointIndex jointId, const Eigen::MatrixBase&lt; Matrix6Like &gt; &amp;J)</div><div class="ttdoc">Computes the Jacobian of a specific joint frame expressed in the local frame of the joint and store t...</div></div>
<div class="ttc" id="structpinocchio_1_1ModelTpl_html_aab6822646f9a53265acb577886434744"><div class="ttname"><a href="structpinocchio_1_1ModelTpl.html#aab6822646f9a53265acb577886434744">pinocchio::ModelTpl::nv</a></div><div class="ttdeci">int nv</div><div class="ttdoc">Dimension of the velocity vector space. </div><div class="ttdef"><b>Definition:</b> <a href="multibody_2model_8hpp_source.html#l00077">multibody/model.hpp:77</a></div></div>
<div class="ttc" id="structpinocchio_1_1DataTpl_html_a417ed37ac15812b72b387b569a16b8d9"><div class="ttname"><a href="structpinocchio_1_1DataTpl.html#a417ed37ac15812b72b387b569a16b8d9">pinocchio::DataTpl::Matrix6x</a></div><div class="ttdeci">Eigen::Matrix&lt; Scalar, 6, Eigen::Dynamic, Options &gt; Matrix6x</div><div class="ttdoc">The 6d jacobian type (temporary) </div><div class="ttdef"><b>Definition:</b> <a href="data_8hpp_source.html#l00066">data.hpp:66</a></div></div>
<div class="ttc" id="namespacepinocchio_html_a97be7e9cd332a591b1431e30bab2c51e"><div class="ttname"><a href="namespacepinocchio.html#a97be7e9cd332a591b1431e30bab2c51e">pinocchio::forwardKinematics</a></div><div class="ttdeci">void forwardKinematics(const ModelTpl&lt; Scalar, Options, JointCollectionTpl &gt; &amp;model, DataTpl&lt; Scalar, Options, JointCollectionTpl &gt; &amp;data, const Eigen::MatrixBase&lt; ConfigVectorType &gt; &amp;q)</div><div class="ttdoc">Update the joint placements according to the current joint configuration. </div></div>
<div class="ttc" id="namespacepinocchio_html_ac1ea82f003a9814a0b1e127d42d32d73"><div class="ttname"><a href="namespacepinocchio.html#ac1ea82f003a9814a0b1e127d42d32d73">pinocchio::neutral</a></div><div class="ttdeci">void neutral(const ModelTpl&lt; Scalar, Options, JointCollectionTpl &gt; &amp;model, const Eigen::MatrixBase&lt; ReturnType &gt; &amp;qout)</div><div class="ttdoc">Return the neutral configuration element related to the model configuration space. </div><div class="ttdef"><b>Definition:</b> <a href="joint-configuration_8hpp_source.html#l00224">joint-configuration.hpp:224</a></div></div>
<div class="ttc" id="namespacepinocchio_1_1buildModels_html_accd83f24a102dbe4845cedc1c9a52f4b"><div class="ttname"><a href="namespacepinocchio_1_1buildModels.html#accd83f24a102dbe4845cedc1c9a52f4b">pinocchio::buildModels::manipulator</a></div><div class="ttdeci">void manipulator(ModelTpl&lt; Scalar, Options, JointCollectionTpl &gt; &amp;model)</div><div class="ttdoc">Create a 6-DOF kinematic chain shoulder-elbow-wrist. </div></div>
<div class="ttc" id="structpinocchio_1_1ModelTpl_html"><div class="ttname"><a href="structpinocchio_1_1ModelTpl.html">pinocchio::ModelTpl</a></div><div class="ttdef"><b>Definition:</b> <a href="multibody_2fwd_8hpp_source.html#l00019">multibody/fwd.hpp:19</a></div></div>
</div><!-- fragment --><h3>Explanation of the code</h3>
<p>The code follows exactly the same steps as Python. Apart from the usual syntactic discrepancies between Python and C++, we can identify two major differences. The first one concerns the Jacobian computation. In C++, you need to pre-allocate its memory space, set it to zero, and pass it as an input <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;  pinocchio::Data::Matrix6x J(6,model.nv); J.setZero();</div><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    pinocchio::jointJacobian(model,data,q,JOINT_ID,J);</div></div><!-- fragment --></p>
<p>This allows to always use the same memory space, avoiding re-allocation and achieving greater efficiency.</p>
<p>The second difference consists in the way the velocity is computed</p>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;  unsigned int svdOptions = Eigen::ComputeThinU | Eigen::ComputeThinV;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  Eigen::BDCSVD&lt;pinocchio::Data::Matrix3x&gt; svd(3,model.nv,svdOptions);</div><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;    const Eigen::VectorXd v     = - svd.compute(J.topRows&lt;3&gt;()).solve(err);</div></div><!-- fragment --></p>
<p>This is equivalent to using the pseudo-inverse, but way more efficient. Also notice we have chosen to pre-allocate the space for the SVD decomposition instead of using method <code>bdcSvd(svdOptions)</code>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Aug 20 2019 11:12:35 for pinocchio by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
